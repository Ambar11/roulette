<%- include("header1") %>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/jquery.dataTables.min.css">

    <style>
        .number-list li.bet {
            background-image: -moz-linear-gradient(26deg, #20ff00 9%, #20ff00cc 39%, #20ff00 100%);
            background-image: ;
            background-image: -ms-linear-gradient(26deg, #382f21 9%, #8b642a 39%, #de9932 100%);
            color: #ffffff;
        }
        
        .cr {
            width: 58%;
            margin-left: 21%;
            margin-top: 5%;
        }
        
        @media (max-width: 768px) {
            .ci2 {
                margin-top: 5%;
            }
        }
    </style>
    <!-- Breadcrumb Area Start -->
    <section class="breadcrumb-area bc-lottery">
        <img class="rotate bc-img" src="assets/images/roulette.png" alt="">
        <div class="container disableE">
            <div class="row">
                <div class="col-lg-12">
                    <h4 class="title">
                        Big bash
                    </h4>
                    <ul class="hs breadcrumb-list">
                        <li>
                            <a href="/">
                                <i class="fas fa-home"></i> Home
                            </a>
                        </li>
                        <li>
                            <span><i class="fas fa-chevron-right"></i> </span>
                        </li>
                        <li>
                            <a href="/user/play">BigBash</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Area End -->
    <% 
    
    let winingPoints = 0;
    let totalBets = 0;
    if (status==0) {
    
    data.map((bets)=>{
winingPoints = winingPoints + parseInt(bets.points);
totalBets++; 
    });

}%>

        <!-- Lottery Staticstics Area Start -->
        <section class="lottery-area">
            <div class="lottery-staticstics">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-4">
                            <div class="single-staticstics">
                                <div class="left">
                                    <div class="icon">
                                        <img src="assets/images/lottery/st1.png" alt="">
                                    </div>
                                </div>
                                <div class="right">
                                    <h4 class="title">Wining Jackpot</h4>
                                    <div class="count">
                                        <img style="max-width:22%;" src="/user/assets/images/coin.png" alt="">
                                        <span><% let win =  winingPoints * 100 %><%= win %></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="single-staticstics">
                                <div class="left">
                                    <div class="icon">
                                        <img src="assets/images/lottery/st2.png" alt="">
                                    </div>
                                </div>
                                <div class="right">
                                    <h4 class="title">Bets</h4>
                                    <div class="count">
                                        <img src="assets/images/tikit-icon.png" alt="">
                                        <span><%=totalBets%></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="single-staticstics">
                                <div class="left">
                                    <div class="icon">
                                        <img src="assets/images/lottery/st2.png" alt="">
                                    </div>
                                </div>
                                <div class="right">
                                    <h4 class="title">Total bet coins </h4>
                                    <div class="count">
                                        <img src="assets/images/tikit-icon.png" alt="">
                                        <span><%=winingPoints%></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <div class="daily-lottery">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-md-10">
                        <div class="section-heading">
                            <h5 class="subtitle">
                                Try to check out our
                            </h5>
                            <h2 class="title">
                                Daily Lottery
                            </h2>
                            <p class="text">
                                We update our site regularly; more and more winners are added every day! To locate the most recent winner's information
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="draw-time">
                            <h5 class="subtitle">
                                Lottery Draw Starts In:
                            </h5>
                            <div class="draw-counter">
                                <div data-countdown="2021/12/15"></div>
                            </div>
                            <p class="text">
                                To meet Today's challenges
                            </p>
                        </div>
                    </div>
                </div>

            </div>
        </div> -->
            <div class="buy-tickets mt-5">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="buy-tickets-box">
                                <div class="heading">
                                    <h4 class="title">
                                        Buy Lottery Tickets
                                    </h4>
                                    <!-- <div class="right-area">
                                    <select>
										<option value="1">BTC</option>
										<option value="1">BTC</option>
										<option value="1">BTC</option>
									</select>
                                </div> -->
                                </div>
                                <div class="content">
                                    <div class="top-area">
                                        <div class="row">
                                            <div class="col-lg-3 col-md-3 col-sm-12">
                                                <div class="info-box">
                                                    <h4 class="title">
                                                        BALANCE
                                                    </h4>
                                                    <div class="number">
                                                        <img style="max-width:15%;" src="/user/assets/images/coin.png" alt="">
                                                        <%=user.points%>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="game-numbers">
                                        <h4 class="title">
                                            GAME NUMBERS
                                        </h4>
                                        <div class="number-box">

                                            <div class="manual-number">
                                                <div class="top-content">
                                                    <!-- <input type="radio" id="manual-num" name="auto-num"> -->

                                                    <label for="manual-num">
														
														<h4 class="title">Select Numbers</h4>
												</label>
                                                </div>
                                                <div class="main-content">
                                                    <ul class="number-list">
                                                        <%for(i=1;i<=100;i++){%>
                                                            <li id="<%=i%>" <% if(status==0){data.map((bets)=>{ if (parseInt(bets.number)===i) {%> class="bet"
                                                                <% }
                                                            }) }%> onclick="makeBet(this)">

                                                                    <%=i%><input value="<%=i%>" id="c<%=i%>" type="checkbox" hidden></li>

                                                            <%}%>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12 text-center">
                                            <div class="row cr">
                                                <div class="col-md-6 ci">
                                                    <label>Enter coins </label>
                                                    <input id="points" type="text" oninput="cal(this)" class=" form-control " placeholder="200 ">
                                                </div>
                                                <div class="col-md-6 ci2 ">
                                                    <label>Total sum of coins </label>

                                                    <input type="text" id="total" class="form-control " placeholder="*100 " disabled>
                                                </div>
                                            </div>
                                            <a onclick="bet()" class="mybtn1 ">Bet</a>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Lottery Staticstics  Area End -->

        <!-- Latest Activities Area Start -->
        <section class="activities ">
            <img class="shape shape1 " src="/user/assets/images/people/shape1.png " alt=" ">
            <img class="shape shape2 " src="/user/assets/images/people/shape2.png " alt=" ">
            <img class="shape shape3 " src="/user/assets/images/people/shape3.png " alt=" ">
            <div class="container ">
                <div class="row justify-content-center ">
                    <div class="col-lg-8 col-md-10 ">
                        <div class="section-heading ">

                            <h2 class="title ">
                                Latest Activites
                            </h2>

                        </div>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-lg-12 ">
                        <div class="tab-menu-area ">
                            <ul class="nav nav-lend mb-3 " id="pills-tab " role="tablist ">
                                <li class="nav-item ">
                                    <a class="nav-link active " id="pills-all-bets-tab " data-toggle="pill " href="#pills-all-bets " role="tab " aria-controls="pills-all-bets " aria-selected="true ">Current Game bets</a>
                                </li>


                            </ul>
                        </div>
                        <div class="tab-content " id="pills-tabContent ">
                            <div class="tab-pane fade show active " id="pills-all-bets " role="tabpanel " aria-labelledby="pills-all-bets-tab ">
                                <div class="responsive-table ">
                                    <table id="example" class="table ">
                                        <thead>
                                            <tr>
                                                <th scope="col ">Number</th>
                                                <th scope="col ">Coins</th>

                                            </tr>
                                        </thead>
                                        <tbody>
                                            <%if(status==0){
                                            sum.map((bets)=>{%>
                                                <tr>
                                                    <td>
                                                        <%=bets.number%>
                                                    </td>

                                                    <td>
                                                        <%=bets.points%>

                                                    </td>
                                                </tr>

                                                <%  });
                                        }else{%>
                                                    <tr>
                                                        <td>
                                                            <p>NO data found</p>
                                                        </td>
                                                        <td>
                                                            <p>NO data found</p>
                                                        </td>

                                                    </tr>

                                                    <% }%>


                                        </tbody>
                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <!-- How it Work Area Start -->
            <div class="how-it-work mt-5 ">
                <img class="bg-shape " src="/user/assets/images/howitwork/bg-shape.png " alt=" ">
                <div class="container ">
                    <div class="row justify-content-center ">
                        <div class="col-lg-8 col-md-10 ">
                            <div class="section-heading ">
                                <h5 class="subtitle ">
                                    Want to see how
                                </h5>
                                <h2 class="title ">
                                    How it works?
                                </h2>
                                <p class="text ">
                                    We update our site regularly; more and more winners are added every day! To locate the most recent winner's information
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="row ">
                        <div class="col-lg-4 ">
                            <div class="single-work ">
                                <img src="assets/images/howitwork/ic1.png " alt=" ">
                                <h4 class="title ">
                                    Choose
                                </h4>
                                <p>
                                    Select your lucky Number !
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-4 ">
                            <div class="single-work ">
                                <img src="assets/images/howitwork/ic2.png " alt=" ">
                                <h4 class="title ">
                                    Spin
                                </h4>
                                <p>
                                    System will automatically Choose the lucky number!
                                </p>
                            </div>
                        </div>
                        <div class="col-lg-4 ">
                            <div class="single-work ">
                                <img src="assets/images/howitwork/ic3.png " alt=" ">
                                <h4 class="title ">
                                    WIN
                                </h4>
                                <p>
                                    Winners will be announced
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- How it Work Area Start -->
        </section>
        <!-- Latest Activities Area End -->



        <!-- Recent Winners Area Start -->
        <section class="recent-winners ">
            <div class="container ">
                <div class="row justify-content-center ">
                    <div class="col-lg-8 col-md-10 ">
                        <div class="section-heading ">
                            <h5 class="subtitle ">
                                Try to Check out our
                            </h5>
                            <h2 class="title ">
                                Recent Winners
                            </h2>
                            <p class="text ">
                                We update our site regularly; more and more winners are added every day! To locate the most recent winner's information
                            </p>
                        </div>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-lg-4 ">
                        <div class="single-winer ">
                            <div class="top-area ">
                                <div class="left ">
                                    <h4 class="name ">
                                        Yash Karaday
                                    </h4>
                                    <p class="date ">
                                        01.08.2019
                                    </p>
                                </div>
                                <div class="right ">
                                    <p class="id ">#010820191</p>
                                </div>
                            </div>
                            <div class="bottom-area ">
                                <div class="left ">
                                    <img style="max-width:22%; " src="/user/assets/images/coin.png " alt=" "> 680000
                                </div>
                                <div class="right ">
                                    <img src="assets/images/icon2.png " alt=" ">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 ">
                        <div class="single-winer ">
                            <div class="top-area ">
                                <div class="left ">
                                    <h4 class="name ">
                                        Karan Patil
                                    </h4>
                                    <p class="date ">
                                        14.07.2019
                                    </p>
                                </div>
                                <div class="right ">
                                    <p class="id ">#140720191</p>
                                </div>
                            </div>
                            <div class="bottom-area ">
                                <div class="left ">
                                    <img style="max-width:22%; " src="/user/assets/images/coin.png " alt=" "> 99000
                                </div>
                                <div class="right ">
                                    <img src="assets/images/icon2.png " alt=" ">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 ">
                        <div class="single-winer ">
                            <div class="top-area ">
                                <div class="left ">
                                    <h4 class="name ">
                                        Ambar patil
                                    </h4>
                                    <p class="date ">
                                        17.09.2019
                                    </p>
                                </div>
                                <div class="right ">
                                    <p class="id ">#170920192</p>
                                </div>
                            </div>
                            <div class="bottom-area ">
                                <div class="left ">
                                    <img style="max-width:22%; " src="/user/assets/images/coin.png " alt=" "> 50000
                                </div>
                                <div class="right ">
                                    <img src="assets/images/icon2.png " alt=" ">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row ">
                    <div class="col-lg-12 text-xl-center ">
                        <a class="mybtn2 " href="# ">View All </a>
                    </div>
                </div>
            </div>
        </section>
        <!-- Recent Winners Area End -->
        <script>
            const numbers = [];

            function makeBet(s) {
                // console.log(s.id); // get id
                var check = document.getElementById(`c${s.id}`).checked
                if (check) {
                    var element = document.getElementById(s.id);
                    element.classList.remove("active");
                    // console.log(`c${s.id}`); // get id
                    document.getElementById(`c${s.id}`).checked = false;
                    var checkbox = document.getElementById(`c${s.id}`).value;
                    // console.log('true');
                    numbers.pop(checkbox);
                } else {
                    // console.log('false');

                    var element = document.getElementById(s.id);
                    element.classList.add("active");
                    // console.log(`c${s.id}`); // get id

                    document.getElementById(`c${s.id}`).checked = true;
                    var checkbox = document.getElementById(`c${s.id}`).value;
                    numbers.push(checkbox);

                    // console.log(checkbox);

                }
                // console.log(numbers);
            }

            function cal(number) {
                var points = document.getElementById("points").value
                var total = numbers.length * points;
                document.getElementById("total").value = total;

            }

            function bet() {
                let checkError = [];
                var points = document.getElementById("points").value
                if (!points || points < 0 || numbers.length === 0) {
                    let message = "please select bet number or please enter the coins";
                    console.log(numbers.length);
                    if (numbers.length === 0) {
                        let message = "please select bet number";
                    } else {
                        let message = "please enter the coins";
                    }
                    swal({
                        title: "Opps something went Wrong",
                        text: message,
                        icon: "warning",
                    });
                } else {
                    var total = numbers.length * points;
                    var count = numbers.length;
                    numbers.forEach(element => {
                        axios.post(`http://localhost:7000/user/makeBet`, {
                            'points': points,
                            'number': element
                        }).then(
                            (response) => {
                                // console.log(response.data.code);
                                // console.log(response.data);
                                let reStatus = response.data;
                                // console.log(reStatus.code);

                                if (parseInt(reStatus.code) < 400) {

                                    // checkError.push(reStatus.code);

                                } else if (parseInt(reStatus.code) >= 400) {
                                    // console.log('error in request');
                                    checkError.push(reStatus.name);
                                    // console.log(checkError);


                                }
                                console.log(checkError.length);
                                if (checkError.length === 0 && count == 0) {
                                    swal("Bets placed ", "Bets are placed successfully!", "success");
                                    setTimeout(location.reload(), 5000)

                                } else if (count == 0) {
                                    swal({
                                        title: "Opps something went Wrong",
                                        text: checkError[0],
                                        icon: "warning",
                                    });
                                }


                                // setTimeout(location.reload(), 4000);

                                var result = response.data;
                                // console.log(result);


                            },
                            (error) => {
                                checkError.push(error.data.code);

                                console.log(error);
                            }
                        );
                        count--;
                    });


                }

            }
        </script>
        <script src="/assets/axios.js"></script>
        <script src="/user/assets/js/jquery.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
        <script>
            $(document).ready(function() {
                $.noConflict();

                $('#example').DataTable({
                    "pagingType": "full_numbers"
                });
            });
        </script>
        <%- include("footer1") %>